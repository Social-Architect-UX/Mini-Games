<!DOCTYPE html>
<html>
<head>
  <title>Glow Tag v2</title>
  <style>
    body {
      margin: 0;
      background: #000;
      overflow: hidden;
      font-family: sans-serif;
      color: white;
    }

    #ui {
      position: fixed;
      top: 10px;
      left: 10px;
      font-size: 18px;
      line-height: 1.5;
      z-index: 5;
    }

    .player {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      position: absolute;
    }

    #you { background: cyan; }
    #it  { background: red; }

    .glow {
      box-shadow: 0 0 25px 12px currentColor;
    }

    #gameOver {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.85);
      display: none;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      font-size: 32px;
      z-index: 10;
    }

    button {
      margin-top: 20px;
      font-size: 18px;
      padding: 10px 20px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<div id="ui">
  ‚è± Player Time: <span id="time">30</span><br>
  ‚ö° Challenger Time: <span id="challengerTime">30</span><br>
  üéÆ Move: Arrow Keys or WASD
</div>

<div id="you" class="player"></div>
<div id="it" class="player"></div>

<div id="gameOver">
  <div id="result"></div>
  <button onclick="restartGame()">Restart</button>
</div>

<script>
  const size = 40;
  const you = { el: document.getElementById("you"), x: 100, y: 100 };
  const ai  = { el: document.getElementById("it"),  x: 400, y: 200 };

  let arenaWidth = window.innerWidth;
  let arenaHeight = window.innerHeight;

  let youAreIt = false;
  let playerTime = 30;
  let challengerTime = 30;
  let gameRunning = true;
  let tagCooldown = 0;

  const keys = {};
  window.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
  window.addEventListener("keyup",   e => keys[e.key.toLowerCase()] = false);
  window.addEventListener("resize", () => {
    arenaWidth = window.innerWidth;
    arenaHeight = window.innerHeight;
  });

  function clamp(p) {
    p.x = Math.max(0, Math.min(arenaWidth - size, p.x));
    p.y = Math.max(0, Math.min(arenaHeight - size, p.y));
  }

  function setItState(playerIsIt) {
    youAreIt = playerIsIt;
    you.el.classList.toggle("glow", youAreIt);
    ai.el.classList.toggle("glow", !youAreIt);
  }

  function moveYou() {
    const speed = youAreIt ? 6 : 4;

    if (keys.arrowup || keys.w) you.y -= speed;
    if (keys.arrowdown || keys.s) you.y += speed;
    if (keys.arrowleft || keys.a) you.x -= speed;
    if (keys.arrowright || keys.d) you.x += speed;

    clamp(you);
  }

  function moveAI() {
    const speed = youAreIt ? 3 : 5;

    const dx = you.x - ai.x;
    const dy = you.y - ai.y;
    const dist = Math.hypot(dx, dy) || 1;

    ai.x += (dx / dist) * speed;
    ai.y += (dy / dist) * speed;

    clamp(ai);
  }

  function checkTag() {
    if (tagCooldown > 0) {
      tagCooldown--;
      return;
    }

    const dx = you.x - ai.x;
    const dy = you.y - ai.y;

    if (Math.hypot(dx, dy) < size) {
      setItState(!youAreIt);
      tagCooldown = 30; // ~0.5s immunity
    }
  }

  function draw() {
    you.el.style.transform = `translate(${you.x}px, ${you.y}px)`;
    ai.el.style.transform  = `translate(${ai.x}px, ${ai.y}px)`;
  }

  function gameLoop() {
    if (!gameRunning) return;
    moveYou();
    moveAI();
    checkTag();
    draw();
    requestAnimationFrame(gameLoop);
  }

  let timer = setInterval(() => {
    if (!gameRunning) return;

    if (youAreIt) {
      playerTime--;
      time.textContent = playerTime;
      if (playerTime <= 0) endGame("üí• You Lose!");
    } else {
      challengerTime--;
      challengerTimeSpan.textContent = challengerTime;
      if (challengerTime <= 0) endGame("üèÜ You Survived!");
    }
  }, 1000);

  const time = document.getElementById("time");
  const challengerTimeSpan = document.getElementById("challengerTime");

  function endGame(msg) {
    gameRunning = false;
    result.textContent = msg;
    gameOver.style.display = "flex";
  }

  function restartGame() {
    gameRunning = true;
    playerTime = challengerTime = 30;
    time.textContent = challengerTimeSpan.textContent = 30;

    you.x = 100; you.y = 100;
    ai.x = 400;  ai.y = 200;

    setItState(false);
    tagCooldown = 0;

    gameOver.style.display = "none";
    gameLoop();
  }

  setItState(false);
  gameLoop();
</script>

</body>
</html>
